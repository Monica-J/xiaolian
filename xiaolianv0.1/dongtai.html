<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>发表动态</title>
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
    <link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css" />
    <script src="js/jquery-2.2.2.js"></script>
    <script src="js/jquery.mobile-1.4.5.min.js"></script>
    <style scoped>
    	video { transform: scaleX(-1); }
    	p { text-align: center; }
	</style>
</head>
<body>
	<div data-role="page">
		<div data-role="header" style="background-color:#6fd7ca; color:white;">
			<a href="mine.html" data-icon="arrow-l" data-iconpos="notext"></a>
			<h1 style="font-weight:200;">发表动态</h1>
			<p style="font-size:15px; float:right; margin:-30px 10px 0 0; font-weight:200;">发表</p>			
		</div>
		<div data-role="content">			
			<h1>Snapshot Kiosk</h1>
			<section id="splash">
    			<p id="errorMessage">Loading...</p>
			</section>
			<section id="app" hidden>
    			<p><video id="monitor" autoplay></video> 
    			<canvas id="photo"></canvas>
    			<p><input type=button value="&#x1F4F7;" onclick="snapshot()">
			</section>
		</div>
	</div>
	<script>
		navigator.getUserMedia({video:true}, gotStream, noStream);
		var video = document.getElementById('monitor');
		var canvas = document.getElementById('photo');
		function gotStream(stream) {
		    video.src = URL.createObjectURL(stream);
		    video.onerror = function () {
		        stream.stop();
		    };
		    stream.onended = noStream;
		    video.onloadedmetadata = function () {
		        canvas.width = video.videoWidth;
		        canvas.height = video.videoHeight;
		        document.getElementById('splash').hidden = true;
		        document.getElementById('app').hidden = false;
		    };
		
		function noStream() {
		    document.getElementById('errorMessage').textContent = 'No camera available.';
		}
		function snapshot() {
		    canvas.getContext('2d').drawImage(video, 0, 0);
		}

		var imgData =canvas.toDataURL("image/png");
		var data = imgData.substr(22);
		var length = atob(data).length;
		$image = base64_decode(str_replace('data:image/jpeg;base64,', '',$data);
		$.post('upload.php',{ 'data' : data } );
</script>
</body>
</html>